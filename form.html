
<input id="name_box" type=text>
<input id="organisation_box" type=text>
<button onClick="submitForm()">Submit</button>
<script>
async function getState(times, url) {
  response = await fetch(url)
  response = await response.json()
  if (response['result']) {
    document.write(JSON.stringify(response['result']) + '<br>')
    return
  } else {
    document.write(response['state'] + '<br>')
  }
  times ++
  wait_time = 30
  if (times < 20) setTimeout(getState, wait_time * 1000, times, url)
}

async function submitForm() {
  full_name = document.getElementById('name_box').value.split(' ')
  organisation = document.getElementById('organisation_box').value.split(' ')
  data = [
      {
        'word_list': full_name,
        'intervening_word_criteria': {
          'first_letter': 'isupper',
          'word_count_less_than': 5
        }
      },
      {
        'word_list': organisation,
        'intervening_word_criteria': {
          'word_count_less_than': 1
        }
      }
  ]
  url = 'https://parse-rdm.herokuapp.com/search/?data=' + encodeURIComponent(JSON.stringify(data))
  response = await fetch(url)
  response = await response.json()
  id = response['id']
  url = 'https://parse-rdm.herokuapp.com/tasks/' + id
  document.write(response['state'] + '<br>')
  setTimeout(getState, 30 * 1000, 1, url)
}
</script>
